## 编写插件

如何编写插件？我们的插件框架提供了最通用的功能，在目前的条件下很难添加能够与主应用交互的插件。所以，你必须再次插件框架的基础之上构建自己的应用程序对象。这意味着，你的应用程序（加载插件的）连同插件本身，都必须遵守同一个交互模型。通常这代表，应用程序需要插件提供特定类型的对象，用于暴露某些特定的 API。插件框架提供所有必须的公共基础代码，用于插件的注册、枚举以及加载。

下面的例子是 C++ 接口定义的`IActor`。这个接口有两个操作：`getInitialInfo()`和`play()`。注意，这个接口并不足以应付所有情况，因为`getInitialInfo()`函数需要一个指向`ActorInfo`结构的指针，而`play()`则需要另外一个接口`ITurn`的指针。这是经常遇见的情况，你必须这么设计，并且指定一个特定的对象模型。

```cpp
struct IActor
{
    virtual ~IActor() {}
    virtual void getInitialInfo(ActorInfo * info) = 0;
    virtual void play( ITurn * turnInfo) = 0;
};
```

每个插件都可以注册`IActor`接口的多个实现。当应用程序决定实例化一个由插件注册的对象时，它就调用由插件实现的`Base_CreateFunc`函数。插件就会做出响应，创建对象并返回给应用程序。函数返回值是`void *`，因为对象的创建操作是通用插件框架的一部分，因此并不知道任何关于特定的`IActor`接口的信息。应用程序负责将`void *`转换成`IActor *`，然后像其他对象一样通过接口调用其函数。当应用程序使用完`IActor`对象时，会调用注册的`PF_DestroyFunc`函数，插件就销毁该对象。至于为什么需要有虚析构函数，我们会在以后的讨论中介绍。